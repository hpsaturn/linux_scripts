#!/bin/bash

# Set your email address via shell input
EMAIL="$1"
SUBJECT="Pending APT Updates on $(hostname)"

# Check if running as root
if [ "$(id -u)" -ne 0 ]; then
    echo "This script must be run as root" >&2
    exit 1
fi

# Update package lists and check for errors
if ! apt-get update >/dev/null 2>&1; then
    echo "Failed to update package lists" | mail -s "APT Update Error on $(hostname)" "$EMAIL"
    exit 1
fi

# Check for upgradable packages
upgradable=$(apt list --upgradable 2>/dev/null | grep -v "Listing...")

if [ -n "$upgradable" ]; then
    # Format the email message
    echo -e "The following packages have updates available:\n\n$upgradable" | mail -s "$SUBJECT" "$EMAIL"
fi
